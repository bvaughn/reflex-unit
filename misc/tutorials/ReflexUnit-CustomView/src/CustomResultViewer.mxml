<?xml version="1.0" encoding="utf-8"?>
<mx:Grid width="100%" height="100%"
         initialize="onInitialize( event )"
         xmlns:mx="http://www.adobe.com/2006/mxml">
	
	<mx:Script>
		<![CDATA[
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			import mx.graphics.SolidColor;
			import mx.graphics.Stroke;
			
			/**
			 * Contains <code>ChartData</code> objects.
			 */
			[Bindable]
			public var dataProvider:ArrayCollection = new ArrayCollection();
			
			[Bindable]
			public var pieChartDataProvider:ArrayCollection = new ArrayCollection();
			
			[Bindable]
			public var timeChartDataProvider:ArrayCollection = new ArrayCollection();
			
			private var _controller:CustomResultViewerController;
			
			[Bindable]
			private var solidColorError:SolidColor = new SolidColor( 0xBB0000, .75 );
			[Bindable]
			private var solidColorFailure:SolidColor = new SolidColor( 0xEEEE00, .75 );
			[Bindable]
			private var solidColorSuccess:SolidColor = new SolidColor( 0x00BB00, .75 );
			
			[Bindable]
			private var strokeError:Stroke = new Stroke( 0xBB0000, 2 );
			[Bindable]
			private var strokeFailure:Stroke = new Stroke( 0xEEEE00, 2 );
			[Bindable]
			private var strokeSuccess:Stroke = new Stroke( 0x00BB00, 2 );
			
			private function onInitialize( event:FlexEvent ):void {
				controller.initialize();
				
				areaChart.filters =
					columnChart.filters =
						lineChart.filters =
							pieChart.filters = [];
			}
			
			public function get controller():CustomResultViewerController {
				if ( _controller == null ) {
					_controller = new CustomResultViewerController( this );
				}
				
				return _controller;
			}
			
			private function getHorizontalAxis( categoryValue:Object, previousCategoryValue:Object, axis:CategoryAxis, categoryItem:Object ):String {
				var array:Array = categoryValue.toString().match( /\:(\w+)$/ );
				
				return array ? array[1] : categoryValue.toString();
			}
		]]>
	</mx:Script>
	
	<mx:GridRow width="100%" height="50%">
		
		<mx:GridItem width="50%" height="100%" verticalAlign="middle">
			
			<mx:ColumnChart id="columnChart" height="100%" width="100%"
			                dataProvider="{ dataProvider }">
				
				<mx:horizontalAxis>
					<mx:CategoryAxis dataProvider="{ dataProvider }" categoryField="testCaseName"
					                 labelFunction="{ getHorizontalAxis }" />
				</mx:horizontalAxis>
				
				<mx:series>
					<mx:ColumnSeries xField="testCaseName" yField="successCount" displayName="Successes"
					                 fill="{ solidColorSuccess }" stroke="{ strokeSuccess }" />
					<mx:ColumnSeries xField="testCaseName" yField="failureCount" displayName="Failures"
					                 fill="{ solidColorFailure }" stroke="{ strokeFailure }" />
					<mx:ColumnSeries xField="testCaseName" yField="errorCount" displayName="Errors"
					                 fill="{ solidColorError }" stroke="{ strokeError }" />
				</mx:series>
			</mx:ColumnChart>
			
			<mx:Legend dataProvider="{ columnChart }" />
			
		</mx:GridItem>
		
		<mx:GridItem width="50%" height="100%" verticalAlign="middle">
			
			<mx:AreaChart id="areaChart" height="100%" width="100%" type="stacked"
			              dataProvider="{ dataProvider }">
				
				<mx:horizontalAxis>
					<mx:CategoryAxis dataProvider="{ dataProvider }" categoryField="testCaseName"
					                 labelFunction="{ getHorizontalAxis }" />
				</mx:horizontalAxis>
				
				<mx:series>
					<mx:AreaSeries yField="successCount" displayName="Successes"
					               areaFill="{ solidColorSuccess }" areaStroke="{ strokeSuccess }" />
					<mx:AreaSeries yField="failureCount" displayName="Failures"
					               areaFill="{ solidColorFailure }" areaStroke="{ strokeFailure }" />
					<mx:AreaSeries yField="errorCount" displayName="Errors"
					               areaFill="{ solidColorError }" areaStroke="{ strokeError }" />
				</mx:series>
			</mx:AreaChart>
			
			<mx:Legend dataProvider="{ areaChart }" />
			
		</mx:GridItem>
		
	</mx:GridRow>
	
	<mx:GridRow width="100%" height="50%">
		
		<mx:GridItem width="50%" height="100%" verticalAlign="middle">
			
			<mx:AreaChart id="lineChart" height="100%" width="100%"
			              dataProvider="{ timeChartDataProvider }">
				
				<mx:horizontalAxis>
					<mx:CategoryAxis dataProvider="{ timeChartDataProvider }" categoryField="time" />
				</mx:horizontalAxis>
				
				<mx:series>
					<mx:AreaSeries yField="testsRemaining" displayName="Remaining"
					               areaFill="{ solidColorError }" areaStroke="{ strokeError }" />
					<mx:AreaSeries yField="testsRun" displayName="Run"
					               areaFill="{ solidColorSuccess }" areaStroke="{ strokeSuccess }" />
				</mx:series>
				
			</mx:AreaChart>
			
			<mx:Legend dataProvider="{ lineChart }" />
			
		</mx:GridItem>
		
		<mx:GridItem width="50%" height="100%" verticalAlign="middle">
			
			<mx:PieChart id="pieChart" width="100%" height="100%"
			             dataProvider="{ pieChartDataProvider }">
				
				<mx:series>
					<mx:PieSeries nameField="statusName" field="count"
					              fills="{ [ solidColorError, solidColorFailure, solidColorSuccess ] }" />
				</mx:series>
				
			</mx:PieChart>
			
			<mx:Legend dataProvider="{ pieChart }"/>
			
		</mx:GridItem>
		
	</mx:GridRow>
	
</mx:Grid>